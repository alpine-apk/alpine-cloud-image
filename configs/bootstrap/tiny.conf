# vim: ts=2 et:
name            = [tiny]
bootstrap_name  = Tiny Cloud
bootstrap_url   = "https://gitlab.alpinelinux.org/alpine/cloud/tiny-cloud"

packages.tiny-cloud = true

WHEN {
  "3.12" {
    # fallback to the old tiny-ec2-bootstrap package
    packages.tiny-cloud                 = null
    packages.tiny-ec2-bootstrap         = true
    services.default.tiny-ec2-bootstrap = true
  }
  "3.13 3.14 3.15 3.16 3.17" {
    # tiny-cloud < 3.0.0 doesn't have --setup option
    services.boot.tiny-cloud-early     = true
    services.default.tiny-cloud        = true
    services.default.tiny-cloud-final  = true
  }
  # tiny-cloud < 3.1.0 don't support autodetect
  "3.13 3.14 3.15 3.16 3.17 3.18 3.19 3.20" {
    packages.tiny-cloud = null
    WHEN {
      aws.packages.tiny-cloud-aws = true
      nocloud.packages.tiny-cloud-nocloud = true
      azure.packages.tiny-cloud-azure = true
      gcp.packages.tiny-cloud-gcp = true
      oci.packages.tiny-cloud-oci = true
    }
  }
}

scripts     = [ setup-tiny ]
